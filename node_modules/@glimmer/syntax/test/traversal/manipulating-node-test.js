'use strict';

var _support = require('../support');

var _syntax = require('@glimmer/syntax');

QUnit.module('[glimmer-syntax] Traversal - manipulating');
['enter', 'exit'].forEach(eventName => {
    QUnit.test(`[${eventName}] Replacing self in a key (returning null)`, assert => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        let el = ast.body[0];
        let attr = el.attributes[0];
        assert.throws(() => {
            (0, _syntax.traverse)(ast, {
                MustacheStatement: {
                    [eventName]: node => {
                        if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                            return null;
                        }
                        return;
                    }
                }
            });
        }, (0, _syntax.cannotRemoveNode)(attr.value, attr, 'value'));
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning an empty array)`, assert => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        let el = ast.body[0];
        let attr = el.attributes[0];
        assert.throws(() => {
            (0, _syntax.traverse)(ast, {
                MustacheStatement: {
                    [eventName](node) {
                        if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                            return [];
                        }
                        return;
                    }
                }
            });
        }, (0, _syntax.cannotRemoveNode)(attr.value, attr, 'value'));
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning a node)`, () => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                        return _syntax.builders.mustache('a');
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `<x y={{a}} />`);
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning an array with a single node)`, () => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                        return [_syntax.builders.mustache('a')];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `<x y={{a}} />`);
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning an array with multiple nodes)`, assert => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        let el = ast.body[0];
        let attr = el.attributes[0];
        assert.throws(() => {
            (0, _syntax.traverse)(ast, {
                MustacheStatement: {
                    [eventName](node) {
                        if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                            return [_syntax.builders.mustache('a'), _syntax.builders.mustache('b'), _syntax.builders.mustache('c')];
                        }
                        return;
                    }
                }
            });
        }, (0, _syntax.cannotReplaceNode)(attr.value, attr, 'value'));
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning null)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return null;
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning an empty array)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return [];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning a node)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return _syntax.builders.mustache('a');
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{a}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning an array with a single node)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return [_syntax.builders.mustache('a')];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{a}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning an array with multiple nodes)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return [_syntax.builders.mustache('a'), _syntax.builders.mustache('b'), _syntax.builders.mustache('c')];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{a}}{{b}}{{c}}{{z}}`);
    });
});
QUnit.module('[glimmer-syntax] Traversal - manipulating (edge cases)');
QUnit.test('Inside of a block', () => {
    let ast = (0, _syntax.preprocess)(`{{y}}{{#w}}{{x}}{{y}}{{z}}{{/w}}`);
    (0, _syntax.traverse)(ast, {
        MustacheStatement(node) {
            if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                return [_syntax.builders.mustache('a'), _syntax.builders.mustache('b'), _syntax.builders.mustache('c')];
            }
            return;
        }
    });
    (0, _support.astEqual)(ast, `{{a}}{{b}}{{c}}{{#w}}{{x}}{{a}}{{b}}{{c}}{{z}}{{/w}}`);
});
QUnit.test('Should recurrsively walk the transformed node', () => {
    let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
    (0, _syntax.traverse)(ast, {
        MustacheStatement(node) {
            if (expectPath(node.path).original === 'x') {
                return _syntax.builders.mustache('y');
            } else if (expectPath(node.path).original === 'y') {
                return _syntax.builders.mustache('z');
            }
            return;
        }
    });
    (0, _support.astEqual)(ast, `{{z}}{{z}}{{z}}`);
});
function expectPath(node) {
    if (node.type !== 'PathExpression') {
        throw new Error(`Expected a PathExpression, got ${node.type}`);
    }
    return node;
}
QUnit.test('Should recurrsively walk the keys in the transformed node', () => {
    let ast = (0, _syntax.preprocess)(`{{#foo}}{{#bar}}{{baz}}{{/bar}}{{else}}{{#bar}}{{bat}}{{/bar}}{{/foo}}`);
    (0, _syntax.traverse)(ast, {
        BlockStatement(node) {
            if (expectPath(node.path).original === 'foo') {
                return _syntax.builders.block(_syntax.builders.path('x-foo'), node.params, node.hash, node.program, node.inverse, node.loc);
            } else if (expectPath(node.path).original === 'bar') {
                return _syntax.builders.block(_syntax.builders.path('x-bar'), node.params, node.hash, node.program, node.inverse, node.loc);
            }
            return;
        },
        MustacheStatement: function (node) {
            if (expectPath(node.path).original === 'baz') {
                return _syntax.builders.mustache('x-baz');
            } else if (expectPath(node.path).original === 'bat') {
                return _syntax.builders.mustache('x-bat');
            }
            return;
        }
    });
    (0, _support.astEqual)(ast, `{{#x-foo}}{{#x-bar}}{{x-baz}}{{/x-bar}}{{else}}{{#x-bar}}{{x-bat}}{{/x-bar}}{{/x-foo}}`);
});
QUnit.test('Exit event is not triggered if the node is replaced during the enter event', assert => {
    let ast = (0, _syntax.preprocess)(`{{x}}`);
    let entered = [];
    let exited = [];
    (0, _syntax.traverse)(ast, {
        MustacheStatement: {
            enter(node) {
                entered.push(expectPath(node.path).original);
                return _syntax.builders.mustache('y');
            },
            exit(node) {
                exited.push(expectPath(node.path).original);
            }
        }
    });
    assert.deepEqual(entered, ['x', 'y']);
    assert.deepEqual(exited, ['y']);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC90ZXN0L3RyYXZlcnNhbC9tYW5pcHVsYXRpbmctbm9kZS10ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQTs7QUFTQSxNQUFNLE1BQU4sQ0FBYSwyQ0FBYjtBQUVDLENBQUMsT0FBRCxFQUFVLE1BQVYsRUFBOEMsT0FBOUMsQ0FBc0QsYUFBWTtBQUNqRSxVQUFNLElBQU4sQ0FBVyxJQUFJLFNBQVMsNENBQXhCLEVBQXNFLFVBQVM7QUFDN0UsWUFBSSxNQUFNLHdCQUFNLGVBQU4sQ0FBVjtBQUNBLFlBQUksS0FBSyxJQUFJLElBQUosQ0FBUyxDQUFULENBQVQ7QUFDQSxZQUFJLE9BQU8sR0FBRyxVQUFILENBQWMsQ0FBZCxDQUFYO0FBRUEsZUFBTyxNQUFQLENBQWMsTUFBSztBQUNqQixrQ0FBUyxHQUFULEVBQWM7QUFDWixtQ0FBbUI7QUFDakIscUJBQUMsU0FBRCxHQUFjLElBQUQsSUFBZ0M7QUFDM0MsNEJBQUksS0FBSyxJQUFMLENBQVUsSUFBVixLQUFtQixnQkFBbkIsSUFBdUMsS0FBSyxJQUFMLENBQVUsS0FBVixDQUFnQixDQUFoQixNQUF1QixHQUFsRSxFQUF1RTtBQUNyRSxtQ0FBTyxJQUFQO0FBQ0Q7QUFDRDtBQUNEO0FBTmdCO0FBRFAsYUFBZDtBQVVELFNBWEQsRUFXRyw4QkFBaUIsS0FBSyxLQUF0QixFQUE2QixJQUE3QixFQUFtQyxPQUFuQyxDQVhIO0FBWUQsS0FqQkQ7QUFtQkEsVUFBTSxJQUFOLENBQVcsSUFBSSxTQUFTLHNEQUF4QixFQUFnRixVQUFTO0FBQ3ZGLFlBQUksTUFBTSx3QkFBTSxlQUFOLENBQVY7QUFDQSxZQUFJLEtBQUssSUFBSSxJQUFKLENBQVMsQ0FBVCxDQUFUO0FBQ0EsWUFBSSxPQUFPLEdBQUcsVUFBSCxDQUFjLENBQWQsQ0FBWDtBQUVBLGVBQU8sTUFBUCxDQUFjLE1BQUs7QUFDakIsa0NBQVMsR0FBVCxFQUFjO0FB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YUFKZ0I7QUFLakIsaUJBQUssSUFBTCxFQUFTO0FBQ1AsdUJBQU8sSUFBUCxDQUFZLFdBQVcsS0FBSyxJQUFoQixFQUFzQixRQUFsQztBQUNEO0FBUGdCO0FBRFAsS0FBZDtBQVlBLFdBQU8sU0FBUCxDQUFpQixPQUFqQixFQUEwQixDQUFDLEdBQUQsRUFBTSxHQUFOLENBQTFCO0FBQ0EsV0FBTyxTQUFQLENBQWlCLE1BQWpCLEVBQXlCLENBQUMsR0FBRCxDQUF6QjtBQUNELENBcEJEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXN0RXF1YWwgfSBmcm9tICcuLi9zdXBwb3J0JztcbmltcG9ydCB7XG4gIHByZXByb2Nlc3MgYXMgcGFyc2UsXG4gIHRyYXZlcnNlLFxuICBidWlsZGVycyBhcyBiLFxuICBBU1QsXG4gIGNhbm5vdFJlbW92ZU5vZGUsXG4gIGNhbm5vdFJlcGxhY2VOb2RlLFxufSBmcm9tICdAZ2xpbW1lci9zeW50YXgnO1xuXG5RVW5pdC5tb2R1bGUoJ1tnbGltbWVyLXN5bnRheF0gVHJhdmVyc2FsIC0gbWFuaXB1bGF0aW5nJyk7XG5cbihbJ2VudGVyJywgJ2V4aXQnXSBhcyBBcnJheTwnZW50ZXInIHwgJ2V4aXQnPikuZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICBRVW5pdC50ZXN0KGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhIGtleSAocmV0dXJuaW5nIG51bGwpYCwgYXNzZXJ0ID0+IHtcbiAgICBsZXQgYXN0ID0gcGFyc2UoYDx4IHk9e3t6fX0gLz5gKTtcbiAgICBsZXQgZWwgPSBhc3QuYm9keVswXSBhcyBBU1QuRWxlbWVudE5vZGU7XG4gICAgbGV0IGF0dHIgPSBlbC5hdHRyaWJ1dGVzWzBdO1xuXG4gICAgYXNzZXJ0LnRocm93cygoKSA9PiB7XG4gICAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgICBbZXZlbnROYW1lXTogKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3onKSB7XG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9LCBjYW5ub3RSZW1vdmVOb2RlKGF0dHIudmFsdWUsIGF0dHIsICd2YWx1ZScpKTtcbiAgfSk7XG5cbiAgUVVuaXQudGVzdChgWyR7ZXZlbnROYW1lfV0gUmVwbGFjaW5nIHNlbGYgaW4gYSBrZXkgKHJldHVybmluZyBhbiBlbXB0eSBhcnJheSlgLCBhc3NlcnQgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShgPHggeT17e3p9fSAvPmApO1xuICAgIGxldCBlbCA9IGFzdC5ib2R5WzBdIGFzIEFTVC5FbGVtZW50Tm9kZTtcbiAgICBsZXQgYXR0ciA9IGVsLmF0dHJpYnV0ZXNbMF07XG5cbiAgICBhc3NlcnQudGhyb3dzKCgpID0+IHtcbiAgICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgICBNdXN0YWNoZVN0YXRlbWVudDoge1xuICAgICAgICAgIFtldmVudE5hbWVdKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3onKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSwgY2Fubm90UmVtb3ZlTm9kZShhdHRyLnZhbHVlLCBhdHRyLCAndmFsdWUnKSk7XG4gIH0pO1xuXG4gIFFVbml0LnRlc3QoYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGEga2V5IChyZXR1cm5pbmcgYSBub2RlKWAsICgpID0+IHtcbiAgICBsZXQgYXN0ID0gcGFyc2UoYDx4IHk9e3t6fX0gLz5gKTtcblxuICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgW2V2ZW50TmFtZV0obm9kZTogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3onKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5tdXN0YWNoZSgnYScpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgYXN0RXF1YWwoYXN0LCBgPHggeT17e2F9fSAvPmApO1xuICB9KTtcblxuICBRVW5pdC50ZXN0KFxuICAgIGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhIGtleSAocmV0dXJuaW5nIGFuIGFycmF5IHdpdGggYSBzaW5nbGUgbm9kZSlgLFxuICAgICgpID0+IHtcbiAgICAgIGxldCBhc3QgPSBwYXJzZShgPHggeT17e3p9fSAvPmApO1xuXG4gICAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgICBbZXZlbnROYW1lXShub2RlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd6Jykge1xuICAgICAgICAgICAgICByZXR1cm4gW2IubXVzdGFjaGUoJ2EnKV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBhc3RFcXVhbChhc3QsIGA8eCB5PXt7YX19IC8+YCk7XG4gICAgfVxuICApO1xuXG4gIFFVbml0LnRlc3QoXG4gICAgYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGEga2V5IChyZXR1cm5pbmcgYW4gYXJyYXkgd2l0aCBtdWx0aXBsZSBub2RlcylgLFxuICAgIGFzc2VydCA9PiB7XG4gICAgICBsZXQgYXN0ID0gcGFyc2UoYDx4IHk9e3t6fX0gLz5gKTtcbiAgICAgIGxldCBlbCA9IGFzdC5ib2R5WzBdIGFzIEFTVC5FbGVtZW50Tm9kZTtcbiAgICAgIGxldCBhdHRyID0gZWwuYXR0cmlidXRlc1swXTtcblxuICAgICAgYXNzZXJ0LnRocm93cygoKSA9PiB7XG4gICAgICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgICAgICBbZXZlbnROYW1lXShub2RlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgICAgICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3onKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtiLm11c3RhY2hlKCdhJyksIGIubXVzdGFjaGUoJ2InKSwgYi5tdXN0YWNoZSgnYycpXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSwgY2Fubm90UmVwbGFjZU5vZGUoYXR0ci52YWx1ZSwgYXR0ciwgJ3ZhbHVlJykpO1xuICAgIH1cbiAgKTtcblxuICBRVW5pdC50ZXN0KGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhbiBhcnJheSAocmV0dXJuaW5nIG51bGwpYCwgKCkgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgIFtldmVudE5hbWVdKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd5Jykge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBhc3RFcXVhbChhc3QsIGB7e3h9fXt7en19YCk7XG4gIH0pO1xuXG4gIFFVbml0LnRlc3QoYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGFuIGFycmF5IChyZXR1cm5pbmcgYW4gZW1wdHkgYXJyYXkpYCwgKCkgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgIFtldmVudE5hbWVdKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd5Jykge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgYXN0RXF1YWwoYXN0LCBge3t4fX17e3p9fWApO1xuICB9KTtcblxuICBRVW5pdC50ZXN0KGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhbiBhcnJheSAocmV0dXJuaW5nIGEgbm9kZSlgLCAoKSA9PiB7XG4gICAgbGV0IGFzdCA9IHBhcnNlKGB7e3h9fXt7eX19e3t6fX1gKTtcblxuICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgW2V2ZW50TmFtZV0obm9kZTogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3knKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5tdXN0YWNoZSgnYScpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgYXN0RXF1YWwoYXN0LCBge3t4fX17e2F9fXt7en19YCk7XG4gIH0pO1xuXG4gIFFVbml0LnRlc3QoXG4gICAgYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGFuIGFycmF5IChyZXR1cm5pbmcgYW4gYXJyYXkgd2l0aCBhIHNpbmdsZSBub2RlKWAsXG4gICAgKCkgPT4ge1xuICAgICAgbGV0IGFzdCA9IHBhcnNlKGB7e3h9fXt7eX19e3t6fX1gKTtcblxuICAgICAgdHJhdmVyc2UoYXN0LCB7XG4gICAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgICAgW2V2ZW50TmFtZV0obm9kZTogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgICAgICAgICBpZiAobm9kZS5wYXRoLnR5cGUgPT09ICdQYXRoRXhwcmVzc2lvbicgJiYgbm9kZS5wYXRoLnBhcnRzWzBdID09PSAneScpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFtiLm11c3RhY2hlKCdhJyldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgYXN0RXF1YWwoYXN0LCBge3t4fX17e2F9fXt7en19YCk7XG4gICAgfVxuICApO1xuXG4gIFFVbml0LnRlc3QoXG4gICAgYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGFuIGFycmF5IChyZXR1cm5pbmcgYW4gYXJyYXkgd2l0aCBtdWx0aXBsZSBub2RlcylgLFxuICAgICgpID0+IHtcbiAgICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgICBNdXN0YWNoZVN0YXRlbWVudDoge1xuICAgICAgICAgIFtldmVudE5hbWVdKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3knKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbYi5tdXN0YWNoZSgnYScpLCBiLm11c3RhY2hlKCdiJyksIGIubXVzdGFjaGUoJ2MnKV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBhc3RFcXVhbChhc3QsIGB7e3h9fXt7YX19e3tifX17e2N9fXt7en19YCk7XG4gICAgfVxuICApO1xufSk7XG5cblFVbml0Lm1vZHVsZSgnW2dsaW1tZXItc3ludGF4XSBUcmF2ZXJzYWwgLSBtYW5pcHVsYXRpbmcgKGVkZ2UgY2FzZXMpJyk7XG5cblFVbml0LnRlc3QoJ0luc2lkZSBvZiBhIGJsb2NrJywgKCkgPT4ge1xuICBsZXQgYXN0ID0gcGFyc2UoYHt7eX19e3sjd319e3t4fX17e3l9fXt7en19e3svd319YCk7XG5cbiAgdHJhdmVyc2UoYXN0LCB7XG4gICAgTXVzdGFjaGVTdGF0ZW1lbnQobm9kZSkge1xuICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3knKSB7XG4gICAgICAgIHJldHVybiBbYi5tdXN0YWNoZSgnYScpLCBiLm11c3RhY2hlKCdiJyksIGIubXVzdGFjaGUoJ2MnKV07XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfSxcbiAgfSk7XG5cbiAgYXN0RXF1YWwoYXN0LCBge3thfX17e2J9fXt7Y319e3sjd319e3t4fX17e2F9fXt7Yn19e3tjfX17e3p9fXt7L3d9fWApO1xufSk7XG5cblFVbml0LnRlc3QoJ1Nob3VsZCByZWN1cnJzaXZlbHkgd2FsayB0aGUgdHJhbnNmb3JtZWQgbm9kZScsICgpID0+IHtcbiAgbGV0IGFzdCA9IHBhcnNlKGB7e3h9fXt7eX19e3t6fX1gKTtcblxuICB0cmF2ZXJzZShhc3QsIHtcbiAgICBNdXN0YWNoZVN0YXRlbWVudChub2RlKSB7XG4gICAgICBpZiAoZXhwZWN0UGF0aChub2RlLnBhdGgpLm9yaWdpbmFsID09PSAneCcpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3knKTtcbiAgICAgIH0gZWxzZSBpZiAoZXhwZWN0UGF0aChub2RlLnBhdGgpLm9yaWdpbmFsID09PSAneScpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3onKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9LFxuICB9KTtcblxuICBhc3RFcXVhbChhc3QsIGB7e3p9fXt7en19e3t6fX1gKTtcbn0pO1xuXG5mdW5jdGlvbiBleHBlY3RQYXRoKG5vZGU6IEFTVC5FeHByZXNzaW9uKTogQVNULlBhdGhFeHByZXNzaW9uIHtcbiAgaWYgKG5vZGUudHlwZSAhPT0gJ1BhdGhFeHByZXNzaW9uJykge1xuICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgYSBQYXRoRXhwcmVzc2lvbiwgZ290ICR7bm9kZS50eXBlfWApO1xuICB9XG5cbiAgcmV0dXJuIG5vZGU7XG59XG5cblFVbml0LnRlc3QoJ1Nob3VsZCByZWN1cnJzaXZlbHkgd2FsayB0aGUga2V5cyBpbiB0aGUgdHJhbnNmb3JtZWQgbm9kZScsICgpID0+IHtcbiAgbGV0IGFzdCA9IHBhcnNlKGB7eyNmb299fXt7I2Jhcn19e3tiYXp9fXt7L2Jhcn19e3tlbHNlfX17eyNiYXJ9fXt7YmF0fX17ey9iYXJ9fXt7L2Zvb319YCk7XG5cbiAgdHJhdmVyc2UoYXN0LCB7XG4gICAgQmxvY2tTdGF0ZW1lbnQobm9kZSkge1xuICAgICAgaWYgKGV4cGVjdFBhdGgobm9kZS5wYXRoKS5vcmlnaW5hbCA9PT0gJ2ZvbycpIHtcbiAgICAgICAgcmV0dXJuIGIuYmxvY2soXG4gICAgICAgICAgYi5wYXRoKCd4LWZvbycpLFxuICAgICAgICAgIG5vZGUucGFyYW1zLFxuICAgICAgICAgIG5vZGUuaGFzaCxcbiAgICAgICAgICBub2RlLnByb2dyYW0sXG4gICAgICAgICAgbm9kZS5pbnZlcnNlLFxuICAgICAgICAgIG5vZGUubG9jXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKGV4cGVjdFBhdGgobm9kZS5wYXRoKS5vcmlnaW5hbCA9PT0gJ2JhcicpIHtcbiAgICAgICAgcmV0dXJuIGIuYmxvY2soXG4gICAgICAgICAgYi5wYXRoKCd4LWJhcicpLFxuICAgICAgICAgIG5vZGUucGFyYW1zLFxuICAgICAgICAgIG5vZGUuaGFzaCxcbiAgICAgICAgICBub2RlLnByb2dyYW0sXG4gICAgICAgICAgbm9kZS5pbnZlcnNlLFxuICAgICAgICAgIG5vZGUubG9jXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfSxcblxuICAgIE11c3RhY2hlU3RhdGVtZW50OiBmdW5jdGlvbihub2RlKSB7XG4gICAgICBpZiAoZXhwZWN0UGF0aChub2RlLnBhdGgpLm9yaWdpbmFsID09PSAnYmF6Jykge1xuICAgICAgICByZXR1cm4gYi5tdXN0YWNoZSgneC1iYXonKTtcbiAgICAgIH0gZWxzZSBpZiAoZXhwZWN0UGF0aChub2RlLnBhdGgpLm9yaWdpbmFsID09PSAnYmF0Jykge1xuICAgICAgICByZXR1cm4gYi5tdXN0YWNoZSgneC1iYXQnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9LFxuICB9KTtcblxuICBhc3RFcXVhbChcbiAgICBhc3QsXG4gICAgYHt7I3gtZm9vfX17eyN4LWJhcn19e3t4LWJhen19e3sveC1iYXJ9fXt7ZWxzZX19e3sjeC1iYXJ9fXt7eC1iYXR9fXt7L3gtYmFyfX17ey94LWZvb319YFxuICApO1xufSk7XG5cblFVbml0LnRlc3QoJ0V4aXQgZXZlbnQgaXMgbm90IHRyaWdnZXJlZCBpZiB0aGUgbm9kZSBpcyByZXBsYWNlZCBkdXJpbmcgdGhlIGVudGVyIGV2ZW50JywgYXNzZXJ0ID0+IHtcbiAgbGV0IGFzdCA9IHBhcnNlKGB7e3h9fWApO1xuXG4gIGxldCBlbnRlcmVkOiBBcnJheTxzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgbnVsbCB8IHVuZGVmaW5lZD4gPSBbXTtcbiAgbGV0IGV4aXRlZDogQXJyYXk8c3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IG51bGwgfCB1bmRlZmluZWQ+ID0gW107XG5cbiAgdHJhdmVyc2UoYXN0LCB7XG4gICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgIGVudGVyKG5vZGUpIHtcbiAgICAgICAgZW50ZXJlZC5wdXNoKGV4cGVjdFBhdGgobm9kZS5wYXRoKS5vcmlnaW5hbCk7XG4gICAgICAgIHJldHVybiBiLm11c3RhY2hlKCd5Jyk7XG4gICAgICB9LFxuICAgICAgZXhpdChub2RlKSB7XG4gICAgICAgIGV4aXRlZC5wdXNoKGV4cGVjdFBhdGgobm9kZS5wYXRoKS5vcmlnaW5hbCk7XG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGFzc2VydC5kZWVwRXF1YWwoZW50ZXJlZCwgWyd4JywgJ3knXSk7XG4gIGFzc2VydC5kZWVwRXF1YWwoZXhpdGVkLCBbJ3knXSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiIn0=